<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetID - Cadastro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');

        /* Vari√°veis de Cor para Tema Monocrom√°tico (Black & Grey) */
        :root {
            --primary-bg: #1A1A1A;      
            --card-bg: #2C2C2C;         
            --header-bg: #121212;       
            --text-color: #E0E0E0;      
            --highlight-text: #FFFFFF;  
            --input-bg: #3A3A3A;        
            --input-border: #505050;    
            --button-primary: #4A4A4A;  
            --button-secondary: #6A6A6A;
            --link-color: #999999;      
            --danger: #E53935;          
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }
        
        body {
            background-color: var(--primary-bg);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        header {
            background: var(--header-bg);
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        
        header img {
            height: 50px;
            margin-right: 15px;
        }

        .logo-icon {
            font-size: 3rem;
            color: var(--highlight-text);
        }
        
        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
        }
        
        header p {
            font-size: 1.1rem;
            color: var(--link-color);
        }

        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid #3A3A3A;
        }
        
        h2 {
            color: var(--highlight-text);
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #4A4A4A;
        }
        
        h3 {
            color: var(--highlight-text); 
            margin-top: 30px; 
            margin-bottom: 20px; 
            border-top: 1px solid #4A4A4A; 
            padding-top: 20px;
            font-size: 1.4rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 500;
            color: var(--text-color);
            font-size: 1.05rem;
        }
        
        input, select {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 1px solid var(--input-border); 
            background-color: var(--input-bg);
            color: var(--text-color);
            border-radius: 8px;
            font-size: 1.05rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--highlight-text);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }
        
        button {
            background-color: var(--button-primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s;
        }
        
        button:hover {
            background-color: #5A5A5A;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--button-secondary);
        }
        
        .btn-secondary:hover {
            background-color: #7A7A7A;
        }

        .form-actions {
            display: flex;
            justify-content: flex-start;
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .qr-section {
            display: flex;
            align-items: flex-start;
            gap: 3rem;
        }

        .qr-form-col {
            flex: 2;
        }

        .qr-display-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 0.5rem;
        }

        .qr-container {
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 1rem;
            background-color: var(--input-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        #qrcode {
            margin: 1rem auto;
            background-color: white;
            padding: 10px;
            border-radius: 4px;
        }
        
        .qr-display-col p {
            color: var(--link-color);
            font-size: 0.95rem;
            margin-top: 0.5rem;
        }

        .qr-actions {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin-top: 1.5rem;
            width: 100%;
        }

        .pet-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .pet-card {
            background: #3A3A3A;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 10px;
            display: flex;
            gap: 1rem;
            align-items: center;
            border: 1px solid #4A4A4A;
        }

        .pet-card-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--highlight-text);
            flex-shrink: 0;
        }
        
        .pet-card-content {
            flex-grow: 1;
        }

        .pet-name {
            color: var(--highlight-text);
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
            line-height: 1.2;
        }
        
        .pet-info {
            font-size: 0.95rem;
            color: var(--link-color);
        }

        .pet-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: flex-end;
        }

        .pet-actions button {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            border-radius: 6px;
        }

        .btn-delete {
            background-color: var(--danger);
        }

        .btn-delete:hover {
            background-color: #C62828;
        }

        #noPetsMessage {
            color: var(--link-color);
            text-align: center;
            font-size: 1.1rem;
            padding: 2rem;
        }

        .hidden { display: none; }
        
        footer {
            background-color: var(--header-bg);
            color: #777777;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            border-top: 1px solid #3A3A3A;
            font-size: 0.9rem;
        }
        
        .dev-info {
            margin-top: 0.8rem;
            font-size: 0.8rem;
            color: #555555;
            line-height: 1.4;
        }
        
        @media (max-width: 900px) {
            .qr-section {
                flex-direction: column;
                gap: 2rem;
                align-items: center;
            }
            .qr-form-col, .qr-display-col {
                width: 100%;
                flex: none;
            }
            .qr-actions {
                flex-direction: row;
                justify-content: center;
            }
        }
        
        @media (max-width: 600px) {
            .container { padding: 0 1rem; }
            h1 { font-size: 2.2rem; }
            h2 { font-size: 1.5rem; }
            .card { padding: 1.5rem; }
            .pet-list { grid-template-columns: 1fr; }
            .qr-actions { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-icon">üêæ</div>
        <div>
            <h1>PetID</h1>
            <p>Identifica√ß√£o segura para seu pet</p>
        </div>
    </header>
    
    <div class="container">
        <div class="card">
            <div class="qr-section">
                <div class="qr-form-col">
                    <h2>Cadastrar Novo Pet</h2>
                    <form id="petForm">
                        <div class="form-group"><label for="petName">Nome do Pet</label><input type="text" id="petName" required placeholder="Ex: Rex, Luna, etc."></div>
                        <div class="form-group"><label for="petType">Tipo de Animal</label>
                            <select id="petType" required>
                                <option value="">Selecione...</option>
                                <option value="Cachorro">Cachorro</option>
                                <option value="Gato">Gato</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group"><label for="petBreed">Ra√ßa</label><input type="text" id="petBreed" placeholder="Ex: Labrador, Siames, etc."></div>
                        
                        <div class="form-group">
                            <label for="petImageUrl">URL da Foto do Pet (Opcional)</label>
                            <input type="url" id="petImageUrl" placeholder="Ex: https://linkdaimagem.com/foto.jpg">
                        </div>

                        <h3>Informa√ß√µes do Dono e Localiza√ß√£o</h3>

                        <div class="form-group"><label for="ownerName">Nome do Dono</label><input type="text" id="ownerName" required placeholder="Seu nome completo"></div>
                        <div class="form-group"><label for="ownerPhone">Telefone do Dono (apenas n√∫meros, com DDD)</label><input type="tel" id="ownerPhone" required placeholder="Ex: 5511999999999"></div>
                        
                        <div class="form-group"><label for="street">Rua</label><input type="text" id="street" required placeholder="Nome da rua"></div>
                        <div class="form-group"><label for="number">N√∫mero</label><input type="text" id="number" required placeholder="N√∫mero da casa"></div>
                        <div class="form-group"><label for="neighborhood">Bairro</label><input type="text" id="neighborhood" required placeholder="Nome do bairro"></div>
                        
                        <div class="form-group">
                            <label for="city">Cidade</label>
                            <input type="text" id="city" value="Raul Soares - MG" readonly style="background-color: var(--button-secondary); color: white;">
                        </div>

                        <div class="form-group"><label for="additionalInfo">Informa√ß√µes Adicionais (opcional)</label><input type="text" id="additionalInfo" placeholder="Alergias, cuidados especiais, etc."></div>
                        
                        <div class="form-actions">
                            <button type="submit">Cadastrar Pet e Gerar QR Code</button>
                            <button id="clearFormBtn" type="button" class="btn-secondary">Limpar Campos</button>
                        </div>
                    </form>
                </div>
                
                <div class="qr-display-col">
                    <h2 style="border-bottom: none; padding-bottom: 0;">QR Code Gerado</h2>
                    <p style="margin-top: 0.5rem; text-align: center; color: var(--link-color);">Para o pet: <span id="currentQrPetName" style="color: var(--highlight-text); font-weight: 600;">(nenhum)</span></p>

                    <div class="qr-container hidden" id="qrContainerDisplay">
                        <div id="qrcode"></div>
                        <p>Escaneie para visualizar a ficha de identifica√ß√£o.</p>
                    </div>
                    
                    <div class="qr-actions">
                        <button onclick="window.print()" class="btn-secondary">Imprimir P√°gina</button>
                        <button id="newPetBtn">Cadastrar Outro Pet</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Meus Pets Cadastrados</h2>
            <div class="pet-list" id="petList">
                <p id="noPetsMessage">Nenhum pet cadastrado ainda. Cadastre seu primeiro pet acima!</p>
            </div>
        </div>
    </div>
    
    <footer>
        <p>PetID &copy; 2025 - Projeto Ace - Ci√™ncia da Computa√ß√£o - Univertix</p>
        <div class="dev-info">
            Desenvolvedores: Gabriel Barbosa, Thayrik Gabriel, Davi Valle, Lara Stafany, Kaiky Andr√©
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const petForm = document.getElementById('petForm');
            const qrContainerDisplay = document.getElementById('qrContainerDisplay');
            const qrcodeDiv = document.getElementById('qrcode');
            const newPetBtn = document.getElementById('newPetBtn');
            const clearFormBtn = document.getElementById('clearFormBtn');
            const petList = document.getElementById('petList');
            const noPetsMessage = document.getElementById('noPetsMessage');
            const currentQrPetName = document.getElementById('currentQrPetName');
            
            // --- INICIALIZA√á√ÉO ROBUSTA DA VARI√ÅVEL PETS ---
            let pets = [];
            try {
                const storedPets = localStorage.getItem('pets');
                pets = storedPets ? JSON.parse(storedPets) : [];
            } catch (e) {
                console.error("Erro ao carregar pets do Local Storage:", e);
                pets = []; 
            }
            // -----------------------------------------------

            updatePetList();
            
            const defaultImageUrl = 'https://via.placeholder.com/80/3A3A3A/FFFFFF?text=Pet';

            petForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Coleta de dados
                const petNameInput = document.getElementById('petName').value;
                const petTypeInput = document.getElementById('petType').value;
                const petBreedInput = document.getElementById('petBreed').value || 'N√£o Informada';
                const petImageUrlInput = document.getElementById('petImageUrl').value.trim(); 

                const petData = {
                    id: Date.now().toString(), 
                    name: petNameInput,
                    type: petTypeInput,
                    breed: petBreedInput,
                    ownerName: document.getElementById('ownerName').value,
                    ownerPhone: document.getElementById('ownerPhone').value.replace(/\D/g, ''),
                    street: document.getElementById('street').value,
                    number: document.getElementById('number').value,
                    neighborhood: document.getElementById('neighborhood').value,
                    city: document.getElementById('city').value, 
                    additionalInfo: document.getElementById('additionalInfo').value,
                    date: new Date().toLocaleDateString('pt-BR'),
                    imageUrl: petImageUrlInput || defaultImageUrl 
                };
                
                // --- C√ìDIGO DE SALVAMENTO REVISADO ---
                try {
                    pets.push(petData);
                    localStorage.setItem('pets', JSON.stringify(pets));
                    console.log("Pet salvo com sucesso no Local Storage.");
                } catch (error) {
                    console.error("Erro ao salvar no Local Storage:", error);
                    alert("Erro ao salvar os dados do pet. Tente novamente.");
                    return; 
                }
                // -------------------------------------
                
                // Gera√ß√£o do QR Code
                generateQRCodeURL(petData.id, petData.name); 
                
                qrContainerDisplay.classList.remove('hidden');
                updatePetList();
                petForm.scrollIntoView({ behavior: 'smooth' }); 
            });
            
            newPetBtn.addEventListener('click', function() {
                petForm.reset();
                qrContainerDisplay.classList.add('hidden');
                qrcodeDiv.innerHTML = '';
                currentQrPetName.textContent = '(nenhum)';
                petForm.scrollIntoView({ behavior: 'smooth' });
            });

            clearFormBtn.addEventListener('click', function() {
                petForm.reset();
            });
            
            function generateQRCodeURL(petId, petName) {
                qrcodeDiv.innerHTML = '';
                
                // URL ABSOLUTA CORRETA PARA O VERCEL
                const qrUrl = `https://pete-id.vercel.app/pet-info.html?id=${petId}`;
                
                new QRCode(qrcodeDiv, {
                    text: qrUrl, 
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
                currentQrPetName.textContent = petName;
            }
            
            function updatePetList() {
                if (pets.length === 0) {
                    noPetsMessage.classList.remove('hidden');
                    petList.innerHTML = '';
                    return;
                }
                
                noPetsMessage.classList.add('hidden');
                petList.innerHTML = '';
                
                pets.forEach(pet => {
                    const petCard = document.createElement('div');
                    petCard.className = 'pet-card';
                    
                    petCard.innerHTML = `
                        <img src="${pet.imageUrl}" alt="${pet.name}" class="pet-card-image">
                        <div class="pet-card-content">
                            <div class="pet-name">${pet.name}</div>
                            <div class="pet-info">
                                <p>Tipo: ${pet.type}</p>
                                <p>Dono: ${pet.ownerName}</p>
                            </div>
                        </div>
                        <div class="pet-actions">
                            <button class="btn-view-qr" data-id="${pet.id}">Ver Ficha</button>
                            <button class="btn-delete" data-id="${pet.id}">Excluir</button>
                        </div>
                    `;
                    
                    petList.appendChild(petCard);
                });
                
                document.querySelectorAll('.btn-view-qr').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const petId = this.getAttribute('data-id');
                        window.open(`pet-info.html?id=${petId}`, '_blank');
                    });
                });
                
                document.querySelectorAll('.btn-delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const petId = this.getAttribute('data-id');
                        
                        if (confirm('Tem certeza que deseja excluir este pet?')) {
                            pets = pets.filter(p => p.id !== petId);
                            localStorage.setItem('pets', JSON.stringify(pets));
                            updatePetList();
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>